<!DOCTYPE html>
<html>

<head>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.5.3/dist/css/bootstrap.min.css"
    integrity="sha384-TX8t27EcRE3e/ihU7zmQxVncDAy5uIKz4rEkgIXeMed4M0jlfIDPvg6uqKI2xXr2" crossorigin="anonymous">
  <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.5/jquery.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/vue"></script>
  <!-- <link rel="stylesheet" href="style.css" /> -->
  <link rel="stylesheet" href="style/all.css" />
  <link rel="stylesheet" href="style/family.css" />
  <!-- <script src="lib/fabric.js"></script> -->
  <script src="code/external/ext.js"></script>
  <script src="code/DBS.js"></script>
  <script src="code/curved.js"></script>
  <link>
</head>

<body>
  <div id="app" class="vh-100">
    <div class="d-flex justify-content-center align-items-center h-100">
      <div class="d-flex flex-column mx-4" style="width:500px">
        <span class="fitem trangeinput d-flex">
          <label class="flabel" style="width: 50px;">Text:</label>
          <input v-model="text" style="width: 100%; text-align: left" type="text" id="214" @keydown="keydown">
        </span>
        <span class="fitem trangeinput">
          <label class="flabel" style="cursor:col-resize;">Curved range:</label>
          <input v-model="curvedRange" class="" type="text" id="214">
          <span class="rangecont">
            <input v-model="curvedRange" class="" type="range" min="-100" max="100" step="1" style="width:97%;" @input="onCurvedRange">
          </span>
        </span>
        <!-- <div class="window textwarp" style="left: 150px; top: 150px;">
          <div class="whead"><span class="wname">Warp</span><span class="cross"
              style="background-image:url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAQAAAAEAAgMAAAAhHED1AAAADFBMVEUAAAAAAAAAAAAAAAA16TeWAAAABHRSTlMA/8ky3+Rv8AAABVtJREFUeJyt289x22gMxmGNdNLs0F1oz7nw4Nk6mN0Z70EF+JAS1IT6UAlugunAtxQRSdYfit+LFz+slkcM/A3xxJZIAFks/rfrj0ryXyL250fhgJ8ieX/gP78a2uTl8M4P6ETyenjjB/QieTN8/8AHjCJ5P4i6gms1tMnLYwwjdCJ5fYxhhF4kb44xjDCK5CMBRjgRzJOX5xhE6ETy+hyDCL1I3pxjEGEUyWcCiPBF8Ji8vMQQQieS15cYQuhF8uYSQwijSL4QIIQrwTR5eYsBhE4kr28xgNCL5HsMIIwi+R7LEe4E9+RpLEXoRPI0liL0InkaSxFGkTyNZQjTcq/Jj7EEoRPJj7EEoRfJj7EEYS+SHwgShOXQJq9mMYuwFsndLGYRNiK5n8Uswl4kzwgswpzglDwnsAhzglPySxMzCHOCU3J7qEGYEwzDv+IOYoSWYPixWLWnhgjt3Q7Hu/3kCC3B38foK0dQBIsCgiRYFBA0QQFBExQQNAFHCAg4QkSAESICjBARUISQgCLEBBAhJoAIMQFDMAQMwREgBEeAEBwBQbAEBMETAARPABA8QY6QEOQIGUGKkBGkCBlBhiAI5n8sHoF8hVsE9VwwvyyCvT2AAAg8AnuKMQiEwCIQAoeACBwCfZALERiBQWAEMQIkiBH4s2yAQAlCBEoQIWCCCKHyOC8ROEGAwAk0QoFAI5TeaBRChUAiVAgkQoVAIpQIFEJz+QZDi9BcvsUBEHyTJUfI2jwpQtZoShGyVleKkDXbMoS83Zcg5A3HBCFveSYIedPVI5C2r0UgjWeLQFrfFoE03x0Ca/8bBDaAMAhsBGIQ2BAmRqBjoBCBDqJCBDoKCxHoMC5C4OPAAIEPJAMEPhINEPhQViMUJqIaoTCT1QiFqbBGKMylJUKFQCJUCCRChaBt+Q/zfsF/uINt6QBh8E/l5+W/QuUA+XuwKxwgfxO3hQPk30IBIfhr5AcEnwc7fEDwibTFBwSfiRgh/FSmB4TfCzt4QPjNtIUHhN+NEMF8O7MDzPPBDh1gnlC26ADzjIQQ7FMaOcA+J+7AAfZJdQsOsM/KACF5Ws8PSN4XdukByRvL9jkCgJC+tT1JkCOkb64ZQvrunCCAt/cnCTIE0MHwCKCHYhFQF+dJAo+AOlkOQfTS2pBBUN08cVMlgoOIxQiqoynuKkaQPdUCgu7qFhB0X7mAoDvbBYSgt44Rou4+RojmCxghmnBghHDGAhHiKQ9EiOdMECGedEEEM2tDCG7ahxDcvBEhuIknQrAzV4Dgp74Awc+dAYKffAOEZPaeImTT/xQh2z9IEbINiBQh3cFoEx72B/ItkPYWHzYY8j0UkfFhz593jcQ9TrsyYBfHIpBtIItA9pEsAtmIsghoJ8sgsK0wg8D20gwC24wzCHA3L0Sg24EhAt1PDBHohmSIgHc0AwS+JRog8D3VAIFvygYIhV1diVDZFpYIlX1liVDZL5AI7YaDaaK3CO9izcQ00VuEg9jyMHOEBuFU7hzBzREahFO5cwQ7R5gjnMvdixhFOJe7ETGI8FXuWsQgwle5SxGDCJdy9yLGEC7lbkQMIVzLXYtYdD0gXMtdilh4TRFu5e5FLLp6Ve5GxKJrMoG6l7sWseia/J+PNxEEA7VRlTuKWHTdEQ4iCGaKN4RpuZ2IRdet3jcRRDPFa73vIohmitd6DyKIxqqdKrfDBLd630QQjlVHVe6ICa71HkQQTpY7VW6HCS71zstdcYKveptyPwuT5V6V+1oYrneq3JfCcH2lyl3tC8P1UZX7WRiu96rc18J+QafKfRGx6FrVdgnE9evZA749e8D9+g2w4Fwzf7ERbQAAAABJRU5ErkJggg==);filter:invert(1);"></span>
          </div>
          <div class="form" style="width:20em">
            <span class="fitem warpbutton">
              <label class="flabel">Style:</label>
              <button>
                <img
                  src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAFwAAAASCAYAAADWvblEAAAC2UlEQVRYR+3YbciecxjH8c8oeSjLM2VrHvIQysMLtFiRaKW9EckYSUISW0mshfGG2QtKaWabluYd2UpkWzbLWrJFYpnJi6FtWmJLQr86zpxdXZfrvN/ovu9dR51dZ9f5O//39f/+j//vOP73FMPjbOS6GntxI97HKfgEu+oaPtJIYUofBrfiHFyPy/ATfizd17gdb+F8/I0zcBo+x4f4Fm+P2PYn0ADP54u4Cn8WvJ+xrIC33/4FJ/QMF+D3VdZfiiPxKRbUooz4F4GAjl2sxXf4AEuH0PkCFw/RPIobcDpuGVnOv7QC/PICHWv4o0MqZmHO6qA7ClvxFN7roD8sJI2lrET8+fkOs96HkzroXkLs5boO2khm4k5kdxzs+M6EkzXAL8EGTMPvPbM4GldiFuLrr+LB8uuN5dWHet45EW/gBWzqQOUYPF26d7C5wzsTUtLuUl7H93gGF2J+dSvX4EvsKZ9PcXytvD82dBE+ru5kCb7Cy1VY53akko5nNtbVZ1NH7sDNuADz8ADux3bcVruy458YH7I28EDeVj32udiPNytT/2r93ACNtokjcE/ZQawmizYdj2B9x2kuxEeV2bGUgI/FBXhidd2nwD9b9hOryv2Eit4+PIBPrcPNoIl8VoV20PMchlJYG1jDgGSRAjQHqiayMxrIu2shMl5zP2zMcfu8F3gye0d5eYpjv9hSp85+z9K9pAA/jui6RDuLo88CPIcncVMLclsXC7oXiyZage130nwFv+KJAbSy1TPhfrEYx+KxLqTRFMvUj4zbRHt3NFkdbbx90nh4M9kZ2IkzW6fMdC/X4grchVWItaRL+aFePA/L8VAVtY7MDy9ZvwwPgWTSyfgGczAVByrz0yamDTy+rnz/LtLN5BSaojeKAQQGAU92p4AG7Bqs+A+CdyP/8MqWf7igj4CPEXjkx+G3MZAbq34MQ08e6aAMnzwzHGczGQH/nxfkHxsejBMC6BxfAAAAAElFTkSuQmCC"
                  class="gsicon" style="width:114.99999828636649px; height:22.499999664723877px">
              </button>
            </span>
            <span class="fitem ddmenu">
              <label class="flabel" for="dd213">Orientation:</label>
              <select class="bbtn" id="dd213">
                <option value="0">Horizontal</option>
                <option value="1">Vertical</option>
              </select>
            </span>
            <span class="fitem trangeinput">
              <label class="flabel" style="cursor:col-resize;">Bend:</label>
              <input v-model="bend" class="" type="text" id="214">
              <span class="rangecont">
                <input v-model="bend" class="" type="range" min="-100" max="100" step="1" style="width:97%;" @input="bendRange">
              </span>
            </span>
            <span class="fitem trangeinput">
              <label class="flabel" style="cursor:col-resize;">Horizontal
                Distortion:</label>
              <input v-model="horizontal" class="" type="text" id="215">
              <span class="rangecont">
                <input v-model="horizontal" class="" type="range" min="-100" max="100" step="1" style="width:97%;">
              </span>
            </span>
            <span class="fitem trangeinput">
              <label class="flabel" style="cursor:col-resize;">Vertical
                Distortion:</label>
              <input v-model="vertical" class="" type="text" id="216">
              <span class="rangecont">
                <input v-model="vertical" class="" type="range" min="-100" max="100" step="1" style="width:97%;">
              </span>
            </span>
            <button class="fitem spread bbtn">OK</button>
          </div>
        </div> -->
      </div>
      <div class="mx-auto">
        <canvas id="canvas" width="1400" height="1000" style="border:1px dotted #000;"></canvas>
      </div>
    </div>
  </div>
  <script>
    var vm = new Vue({
      el: '#app',
      data: {
        curvedRange: 0,
        horizontal: 0,
        vertical: 0,
        range: 0,
        radius: 200,
        spacing: 63,
        fontFamily: 'FranklinGothic-Heavy',
        fontSize: 28,
        text: 'Hello Word!',
        lineHeight: 1,
        top: 200,
        left: 10,
        char: 0,
        textWidth: 0,
        selected: 'circle',
        obj: {},
        canvas: null,
        ctx: null,
        group: null,
        reverse: false,
        Y: null,
        TySh: null,
        l1: {}
      },
      mounted() {
        this.canvas = document.getElementById("canvas");
        this.ctx = this.canvas.getContext("2d")
        // this.ctx.font = "30px Georgia";
        // this.ctx.fillText("Hello World!", 10, 50);
        // let VW = 
        this.Y = new curved.dD;
        let vm = this;
        curved.B8();
        $.getJSON("text.json", function (text) {
          curved.zG(undefined, undefined, undefined, text, undefined, undefined);
        });
        // $.getJSON("TySh.json", function (TySh) {
        //   vm.TySh = TySh;
        //   vm.onCurved()
        // });
      },
      methods: {
        onCurved() {
          let vm = this;
          fetch("rsrc/fonts/fs/DejaVuSans-Bold.otf").then(function (R) {
            return R.arrayBuffer()
          }).then(function (R) {
            vm.Y.jp.jq.l1['DejaVuSans-Bold'] = Typr.parse(R)[0]
            vm.TySh.Cp.Txt.v = vm.text;
            vm.TySh.P5.warpValue.v = vm.curvedRange;
            vm.TySh.VW.EngineDict.Editor.Text = vm.text;
            vm.TySh.VW.EngineDict.ParagraphRun.RunLengthArray[0] = vm.text.length;
            curved.EM(undefined, vm.Y, undefined, vm.TySh);
          })
        },
        onCurvedRange(event) {
          this.onCurved();
        },
        keydown() {
          this.onCurved();
        },

        onChange(e) {
          this.setObjects();
          this.setProps();
          this.canvas.renderAll();
        },

        setObjects() {
          this.canvas.setActiveObject(this.canvas.item(0));
          this.obj = this.canvas.getActiveObject();
        },

        setProps() {
          this.obj.set('effect', this.selected)
          // this.obj.setText(this.text);
          this.obj.setCoords();
        },
      }
    })
  </script>
</body>

</html>